# 微信私域搜索API返回结果示例

## API响应结构

微信私域搜索API返回的JSON结构如下：

```json
{
    "articles": [
        {
            "title": "Gemini偷袭珍珠港",
            "link": "https://mp.weixin.qq.com/s?src=11&timestamp=1754547133&ver=6159&signature=JdqcPrO8Ul8Vc3L0MerNTPAz7CXoLK3XdJKH94Bw2yaMu60NFbakmzuaZmqai5ilX*Hz40QkC1Il8BwDzd6wckvbxxJT9o7qaTSXG87KcNxvuMGqriOTN18r7hjEq-I4&new=1",
            "account": "顶级程序员",
            "publish_time": "2023-12-08 12:15",
            "summary": "趁着 ChatGPT 这一段时间元气大伤,Gemini开始发力,立马发布了最新的大模型版本,测评结果显示,各项指标优于 GPT-4,真的是...",
            "content_markdown": "趁着 ChatGPT 这一段时间元气大伤，Gemini 开始发力，立马发布了最新的大模型版本，测评结果显示，各项指标优于 GPT-4，真的是这样吗？  \n\n这个事情我先采访了一下当事人 Bard，他是这样说的：\n\n![](https://mmbiz.qpic.cn/mmbiz_png/8wsQz4uwibInRSQfJlIIONObPzp69J41ENLb4B6npJVpbPnUFu9SVexvEpB6s9iba1xZiaVUCarA4VOibmOIjwzyVA/640?wx_fmt=png&from=appmsg)\n\n关键特征相差不大：\n\n![](https://mmbiz.qpic.cn/mmbiz_png/8wsQz4uwibInRSQfJlIIONObPzp69J41E0ibpPnLiczB9VWsZkbfjBNibrBsX8Ps9ONImaGdRbf465wzCiauwoVMxfg/640?wx_fmt=png&from=appmsg)\n\nGemini 的自我评价：\n\n![](https://mmbiz.qpic.cn/mmbiz_png/8wsQz4uwibInRSQfJlIIONObPzp69J41E67cBEdrqUavic1NtBsZFXic5YZpppnfUl4tDAdIFEAJfO2oht12hgq9A/640?wx_fmt=png&from=appmsg)\n\n前几天我也做过一次测评，Bard 目前的能力还没有达到 GPT-4 的水平。  \n\n不过，Gemini 模型的发布标志着人工智能技术的一个重要转折点。作为谷歌最新的大模型，Gemini 在多个方面展现了其卓越性能。\n\nGemini 在32个基准测试中拿下了30个最佳状态（State of the Art, SOTA），甚至在 MMLU 基准上达到了人类专家的水平。这一成就不仅显示了其技术实力，更是对人工智能领域未来发展方向的一次显著指引。\n\nGemini 模型的核心特点是其原生多模态能力，这意味着它能够无缝地处理和理解不同类型的数据。这种能力在多个领域都显得尤为重要。\n\n从文本到图像，从声音到视频，Gemini 都能够进行深入分析和理解。这样的多模态处理能力，为解决复杂问题和提供创新解决方案提供了更广阔的可能性。\n\nGemini 的应用前景广阔。在学术领域，它能够帮助研究人员从大量数据中快速提取关键信息，极大提升研究效率。在商业领域，从广告推荐到智能搜索，Gemini 的应用将使用户体验更加个性化和高效。\n\n谷歌已经计划将 Gemini 引入其多个产品线，包括搜索、广告、Chrome 和 Duet AI，这将极大地提升这些服务的智能化水平。\n\nGemini 的出现不仅仅是一项技术革新，它更是对人工智能未来方向的一种预示。随着技术的发展，人工智能将越来越多地融入我们的生活。\n\nGemini 模型的成功，展现了多模态大模型的强大潜力和广泛应用前景，这将推动整个领域向更高层次的发展。\n\n大幕已经拉开，好戏即将上演...  \n\n**作者简介**\n\n您好，我是奇大，毕业于北邮，前端技术专家，AI 布道师。\n\n10 多年互联网研发和管理经验，我将分享高质量的职场认知和技术干货，欢迎围观。"
        },
        {
            "title": "Gemini背后,谷歌真正可怕之处并不在模型本身",
            "link": "https://mp.weixin.qq.com/s?src=11&timestamp=1754547133&ver=6159&signature=UlorxzTeZaE-6ahQtr8IMzycTUrCT5yPT*hKFzqFHXHmNz*8Q6DSqneuOpLcI*Kiyl*IHsGaOTpNtZZF3M-MsBfFVfudujXjIdrCHs7HvdToV9t*ZdI-DncgAUUBahsq&new=1",
            "account": "酷玩实验室",
            "publish_time": "2023-12-13 22:29",
            "summary": "本文来自公众号硅星人Pro(ID:Si-Planet)谷歌的大语言模型Gemini1.0,一经问世就技惊四座.首先在性能方面,无论是从对文本、图...",
            "content_markdown": null
        },
        {
            "title": "Gemini1.5 杀死了 RAG ?",
            "link": "https://mp.weixin.qq.com/s?src=11&timestamp=1754547133&ver=6159&signature=9vjc48bBDRJvjBiNIO3HZdoGkeUheDs4nNI5xT-1GBT2Y0uzt7o-DvIFEipgJzE8Tyo7lEebv5H1nGwewo*5KCTb1lBN6fRjdgW0qminEDMFUWB*mczayZtT*4lVIfi7&new=1",
            "account": "51CTO技术栈",
            "publish_time": "2024-02-24 08:40",
            "summary": "撰稿 | 言征 谷歌最近发布的Gemini1.5具有1M的上下文长度窗口,引发了一场关于"RAG(检索增强生成)是否仍然重要"的新辩论...",
            "content_markdown": "![](https://mmbiz.qpic.cn/mmbiz_gif/MOwlO0INfQorLT4hmMibiaMIuR4ic1Og..."
        }
    ]
}
```

## 字段说明

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `title` | string | 文章标题 | "Gemini偷袭珍珠港" |
| `link` | string | 文章链接 | "https://mp.weixin.qq.com/s?..." |
| `account` | string | 公众号名称 | "顶级程序员" |
| `publish_time` | string | 发布时间 | "2023-12-08 12:15" |
| `summary` | string | 文章摘要 | "趁着 ChatGPT 这一段时间元气大伤..." |
| `content_markdown` | string/null | 文章内容（Markdown格式） | 完整的文章内容或null |

## 需要适配的代码修改

### 1. 修改结果提取逻辑

当前代码：
```python
items = api_results.get('data', []) or api_results.get('results', [])
```

需要修改为：
```python
items = api_results.get('articles', []) or api_results.get('data', []) or api_results.get('results', [])
```

### 2. 修改字段映射

在 `WeChatSearcher.parse_item` 方法中，需要适配以下字段映射：

```python
# 标题字段
title = item.get('title', '')

# 内容字段（优先使用summary，如果没有则使用content_markdown）
content = item.get('summary', '') or item.get('content_markdown', '')

# 链接字段
url = item.get('link', '')

# 发布时间字段
publish_time_str = item.get('publish_time', '')

# 作者字段
author = item.get('account', '')
```

## 问题分析

当前系统返回0个结果的原因是：

1. **键名不匹配**：API返回的键是 `articles`，但代码中查找的是 `data` 或 `results`
2. **字段映射不完整**：需要正确映射 `title`、`summary`、`link`、`publish_time`、`account` 等字段

## 解决方案

1. 修改 `core/engines/private_domain_engine.py` 中的结果提取逻辑
2. 更新 `WeChatSearcher.parse_item` 方法中的字段映射
3. 确保所有字段都能正确解析和映射

这样修改后，微信私域搜索应该能够正确解析API返回的结果并显示在搜索结果中。

## 最新更新：移除基础关键词匹配

### 修改说明

为了提高搜索的灵活性和准确性，我们移除了所有搜索引擎中的基础关键词匹配逻辑。这意味着：

1. **更灵活的搜索**：不再要求搜索结果必须包含查询中的关键词
2. **更好的相关性**：完全依赖智能相关性评分系统来判断结果质量
3. **更全面的结果**：能够返回语义相关但不一定包含关键词的结果

### 修改位置

- **微信搜索** (`core/engines/private_domain_engine.py` - `WeChatSearcher.parse_item`)
- **知乎搜索** (`core/engines/private_domain_engine.py` - `ZhihuSearcher.parse_item`)

### 测试验证

移除关键词匹配后，搜索功能表现良好，能够返回高质量的相关结果，同时保持了良好的相关性评分。

## 修复snippet和content重复问题

### 问题描述

在搜索结果中，`snippet` 和 `content` 字段使用了相同的内容，导致信息重复。

### 解决方案

#### 1. 微信搜索修复

**修改前：**
```python
return SearchResult(
    title=title,
    url=url,
    snippet=content[:200],  # 直接截取content
    content=content,        # 完整内容
    # ...
)
```

**修改后：**
```python
# 为snippet创建更合适的预览内容
# 优先使用summary作为snippet，如果没有则截取content的前50字符
snippet_content = item.get('summary', '') or content[:50]

return SearchResult(
    title=title,
    url=url,
    snippet=snippet_content,  # 使用专门的snippet内容
    content=content,          # 完整内容
    # ...
)
```

#### 2. 知乎搜索修复

**修改前：**
```python
return SearchResult(
    title=title,
    url=url,
    snippet=content[:200],  # 直接截取content
    content=content,        # 完整内容
    # ...
)
```

**修改后：**
```python
# 为知乎内容创建合适的snippet
# 优先使用摘要字段，如果没有则截取content的前50字符
snippet_content = item.get('excerpt', '') or item.get('summary', '') or content[:50]

return SearchResult(
    title=title,
    url=url,
    snippet=snippet_content,  # 使用专门的snippet内容
    content=content,          # 完整内容
    # ...
)
```

#### 3. ZAI搜索修复

**修改前：**
```python
snippet = clean_text(item.content or '')  # 直接使用content作为snippet
```

**修改后：**
```python
content = clean_text(item.content or '')
# 为snippet创建合适的预览内容
snippet = content[:50] if len(content) > 50 else content
```

### 改进效果

1. **避免内容重复**：`snippet` 和 `content` 现在使用不同的内容
2. **更好的预览体验**：`snippet` 使用专门的摘要或截取内容
3. **保持完整性**：`content` 保留完整的内容信息
4. **智能选择**：优先使用API提供的摘要字段，备选截取内容
